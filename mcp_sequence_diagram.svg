<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
    MCP 集成时序图 - AI应用与工具交互流程
  </text>
  
  <!-- 参与者 -->
  <!-- 用户 -->
  <rect x="50" y="60" width="120" height="60" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="110" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">用户</text>
  <text x="110" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">(User)</text>
  
  <!-- AI应用/Agent层 -->
  <rect x="250" y="60" width="180" height="60" rx="10" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="340" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">AI 应用 / Agent 层</text>
  <text x="340" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">(内置 MCP 客户端)</text>
  
  <!-- 大模型 -->
  <rect x="500" y="60" width="180" height="60" rx="10" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="590" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">大模型 (LLM)</text>
  <text x="590" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">(e.g., OpenAI / Claude)</text>
  
  <!-- MCP服务端 -->
  <rect x="750" y="60" width="180" height="60" rx="10" fill="#27ae60" stroke="#229954" stroke-width="2"/>
  <text x="840" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">MCP 服务端 (Tools)</text>
  <text x="840" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">(DB / API / 外部资源)</text>
  
  <!-- 生命线 -->
  <line x1="110" y1="120" x2="110" y2="750" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="340" y1="120" x2="340" y2="750" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="590" y1="120" x2="590" y2="750" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="840" y1="120" x2="840" y2="750" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- 步骤1: 用户输入 -->
  <g>
    <line x1="110" y1="160" x2="340" y2="160" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="225" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(1) 用户输入</text>
    <text x="225" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">"获取今日订单"</text>
  </g>
  
  <!-- 步骤2: 应用发送请求给LLM -->
  <g>
    <line x1="340" y1="210" x2="590" y2="210" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="465" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(2) 应用发送请求给 LLM</text>
  </g>
  
  <!-- LLM内部处理 -->
  <g>
    <rect x="570" y="230" width="40" height="60" fill="#f39c12" stroke="#e67e22" stroke-width="1"/>
    <text x="590" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">语义</text>
    <text x="590" y="262" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">分析</text>
    <text x="590" y="274" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">生成</text>
    <text x="590" y="286" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">tool_call</text>
  </g>
  
  <!-- 步骤3: LLM返回tool_call -->
  <g>
    <line x1="590" y1="310" x2="340" y2="310" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="465" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">返回 tool_call (JSON Schema)</text>
  </g>
  
  <!-- 步骤4: MCP客户端解析 -->
  <g>
    <rect x="320" y="330" width="40" height="40" fill="#f39c12" stroke="#e67e22" stroke-width="1"/>
    <text x="340" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">MCP</text>
    <text x="340" y="357" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">解析</text>
    <text x="465" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(3) MCP 客户端解析 tool_call</text>
  </g>
  
  <!-- 步骤5: 调用MCP服务端 -->
  <g>
    <line x1="340" y1="410" x2="840" y2="410" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="590" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(4) 调用 MCP 服务端执行操作</text>
  </g>
  
  <!-- 步骤6: 服务端执行任务 -->
  <g>
    <rect x="820" y="430" width="40" height="60" fill="#f39c12" stroke="#e67e22" stroke-width="1"/>
    <text x="840" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">执行</text>
    <text x="840" y="462" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">任务</text>
    <text x="840" y="474" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">(DB</text>
    <text x="840" y="486" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">查询)</text>
    <text x="950" y="465" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(5) 服务端执行任务</text>
  </g>
  
  <!-- 步骤7: 返回JSON结果 -->
  <g>
    <line x1="840" y1="510" x2="340" y2="510" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="590" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">返回 JSON 结果</text>
  </g>
  
  <!-- 步骤8: 注入结果到模型 -->
  <g>
    <line x1="340" y1="550" x2="590" y2="550" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="465" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(6) MCP 客户端注入结果到模型</text>
  </g>
  
  <!-- LLM处理结果 -->
  <g>
    <rect x="570" y="570" width="40" height="40" fill="#f39c12" stroke="#e67e22" stroke-width="1"/>
    <text x="590" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">整合</text>
    <text x="590" y="597" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">生成</text>
  </g>
  
  <!-- 步骤9: 返回最终内容 -->
  <g>
    <line x1="590" y1="630" x2="340" y2="630" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="465" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">返回最终内容</text>
  </g>
  
  <!-- 步骤10: 输出结果给用户 -->
  <g>
    <line x1="340" y1="680" x2="110" y2="680" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="225" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">(7) 应用输出结果</text>
    <text x="225" y="695" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">"今日订单共 12 笔"</text>
  </g>
  
  <!-- 箭头定义 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
  </defs>
  
  <!-- 图例 -->
  <g transform="translate(50, 770)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">关键特点:</text>
    <text x="100" y="0" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">• MCP协议标准化工具调用</text>
    <text x="280" y="0" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">• 支持实时SSE通信</text>
    <text x="420" y="0" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">• 统一AI服务接口</text>
    <text x="560" y="0" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">• 可扩展工具生态</text>
  </g>
</svg>